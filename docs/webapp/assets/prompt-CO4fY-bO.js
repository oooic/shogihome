import{f as P,G as E,l as b,g as n,o as l,i as c,y as p,A as t,t as u,F as N,v as F,_ as k,H as D,ad as R,s as T,x as S,u as A,ae as w,X as C,a1 as H,az as L,bF as M,bG as K}from"./confirm-B6YvaOPl.js";import{d as G,e as m,g as $}from"./setup-4HB7R3N4.js";import{P as U}from"./prompt-BVNwYAgJ.js";import{H as B,T as f,i as Y}from"./HorizontalSelector-DpRTNjkI.js";const V={class:"column"},x={class:"row"},J=["placeholder"],W={id:"command-candidates"},z=["value"],q=["value"],X={class:"row settings"},j=P({__name:"CommandInput",setup(h){const s=G(),r=E(m.SEND),d=E(!1),v=E(!0),_=E(!0);function O(e){let o=e.value;v.value&&(o=o.trim()),_.value&&(o=o.replace(/\s+/g," ")),!(!d.value&&o==="")&&(s.invokeCommand(r.value,o),e.value="")}const I=b(()=>{const e={};let o=0;for(let a=s.history.commands.length-1;a>=0;a--){const g=s.history.commands[a];if(g.type===r.value&&e[g.command]!==null&&(e[g.command]=null,o++,o>=64))break}return Object.keys(e)}),i=b(()=>{switch(s.target){case U.CSA:switch(r.value){case m.SEND:return["LOGIN ","LOGOUT","AGREE","REJECT","%TORYO","%KACHI","%CHUDAN","%%WHO","%%CHAT ","%%GAME ","%%CHALLENGE ","%%LIST","%%SHOW ","%%MONITORON ","%%MONITOROFF ","%%MONITOR2ON ","%%MONITOR2OFF ","%%RATING","%%SETBUOY ","%%DELETEBUOY ","%%GETBUOYCOUNT ","%%FORK "];case m.RECEIVE:return["LOGIN:","LOGIN:incorrect","LOGOUT:completed","BEGIN Game_Summary","Protocol_Version:1.2","Protocol_Mode:Server","Format:Shogi 1.0","Declaration:Jishogi 1.1","Game_ID:","Name+:","Name-:","Your_Turn:+","Your_Turn:-","Rematch_On_Draw:YES","Rematch_On_Draw:NO","To_Move:+","To_Move:-","Max_Moves:","BEGIN Time","Time_Unit:1sec","Total_Time:","Byoyomi:","Delay:","Increment:","Least_Time_Per_Move:","END Time","BEGIN Position","P1-KY-KE-GI-KI-OU-KI-GI-KE-KY","P2 * -HI *  *  *  *  * -KA * ","P3-FU-FU-FU-FU-FU-FU-FU-FU-FU","P4 *  *  *  *  *  *  *  *  * ","P5 *  *  *  *  *  *  *  *  * ","P6 *  *  *  *  *  *  *  *  * ","P7+FU+FU+FU+FU+FU+FU+FU+FU+FU","P8 * +KA *  *  *  *  * +HI * ","P9+KY+KE+GI+KI+OU+KI+GI+KE+KY","P+","P-","END Position","END Game_Summary","START","REJECT:","%TORYO,T","%KACHI,T","#SENNICHITE","#DRAW","#OUTE_SENNICHITE","#ILLEGAL_MOVE","#TIME_UP","#RESIGN","#JISHOGI","#MAX_MOVES","#CENSORED","#CHUDAN","#ILLEGAL_ACTION","#WIN","#LOSE"]}break;case U.USI:switch(r.value){case m.SEND:return["usi","isready","setoption name ","usinewgame","position sfen ","position startpos moves ","go btime ","go ponder btime ","go infinite","go mate ","go mate infinite","stop","ponderhit","quit","gameover win","gameover lose","gameover draw"];case m.RECEIVE:return["id name ","id author ","usiok","readyok","bestmove ","bestmove resign","bestmove win","info depth ","info time ","info nodes ","info pv ","info multipv ","info score cp ","info score mate ","info currmove ","info hashfull ","info nps ","info string ","option name ","option name USI_Hash type spin","option name USI_Hash type spin default ","option name USI_Ponder type check","option name USI_Ponder type check default ","checkmate ","checkmate notimplemented","checkmate timeout","checkmate nomate"]}break}return[]});return(e,o)=>(l(),n("div",null,[c("div",V,[c("div",x,[p(B,{value:r.value,"onUpdate:value":o[0]||(o[0]=a=>r.value=a),height:24,items:[{value:t(m).SEND,label:t(s).target===t(U).CSA?`▶ ${t(u).csaServer}`:`▶ ${t(u).usiEngine}`},{value:t(m).RECEIVE,label:`◀ ${t(u).shogiHome}`}]},null,8,["value","items"]),c("input",{class:"grow",type:"text",placeholder:t(u).typeCommandHereAndPressEnter,list:"command-candidates",onKeydown:o[1]||(o[1]=a=>{if(a.key!=="Enter")return;const g=a.target;O(g)})},null,40,J),c("datalist",W,[(l(!0),n(N,null,F(i.value,a=>(l(),n("option",{key:a,value:a},null,8,z))),128)),(l(!0),n(N,null,F(I.value,a=>(l(),n("option",{key:a,value:a},null,8,q))),128))])]),c("div",X,[p(f,{value:d.value,"onUpdate:value":o[2]||(o[2]=a=>d.value=a),label:t(u).allowBlankLine},null,8,["value","label"]),p(f,{value:v.value,"onUpdate:value":o[3]||(o[3]=a=>v.value=a),label:t(u).removeSpaceFromBothEnds},null,8,["value","label"]),p(f,{value:_.value,"onUpdate:value":o[4]||(o[4]=a=>_.value=a),label:t(u).collapseSequentialSpaces},null,8,["value","label"])])])]))}}),Q=k(j,[["__scopeId","data-v-834c82cf"]]),Z={class:"root column"},ee={class:"tools row"},te=["placeholder"],oe={class:"history column"},ae={key:0,class:"discarded"},se=["id"],ne={key:0,class:"timestamp"},le={key:1,class:"send"},ie={key:2,class:"receive"},re={key:3,class:"system"},ue=P({__name:"CommandHistory",setup(h){const s=G(),r=E(!0),d=E(!1),v=E("");let _=null;function O(){if(s.history.commands.length){const I=s.history.commands[s.history.commands.length-1];if(r.value&&(_===null||I.id!==_)){const i=document.getElementById(`history-${I.id}`);i==null||i.scrollIntoView({behavior:"auto",block:"nearest"}),_=I.id}}}return D(()=>{O()}),R(()=>{O()}),(I,i)=>(l(),n("div",null,[c("div",Z,[c("div",ee,[p(f,{value:r.value,"onUpdate:value":i[0]||(i[0]=e=>r.value=e),label:t(u).autoScroll},null,8,["value","label"]),p(f,{value:d.value,"onUpdate:value":i[1]||(i[1]=e=>d.value=e),label:t(u).showTimestamp},null,8,["value","label"]),c("input",{class:"search-text",type:"text",placeholder:t(u).highlightByPartialMatch,onInput:i[2]||(i[2]=e=>{v.value=t(Y)(e)})},null,40,te)]),c("div",oe,[t(s).history.discarded?(l(),n("div",ae,S(t(s).history.discarded)+" commands discarded ",1)):T("",!0),(l(!0),n(N,null,F(t(s).history.commands,e=>(l(),n("div",{id:`history-${e.id}`,key:e.id,class:A(["entry",{highlight:v.value&&e.command.includes(v.value)}])},[d.value?(l(),n("span",ne,S(e.dateTime),1)):T("",!0),e.type===t(m).SEND?(l(),n("span",le,"▶")):T("",!0),e.type===t(m).RECEIVE?(l(),n("span",ie,"◀")):T("",!0),e.type===t(m).SYSTEM?(l(),n("span",re,"◼")):T("",!0),w(" "+S(e.command),1)],10,se))),128))])])]))}}),me=k(ue,[["__scopeId","data-v-fa36a8e9"]]),ce=P({__name:"PromptMain",setup(h){const s=C();return(r,d)=>(l(),n("div",{class:A(["root full",t(s).thema])},[p(me,{class:"history"}),p(Q,{class:"input"})],2))}}),de=k(ce,[["__scopeId","data-v-8339972d"]]);H.log(L.INFO,"start renderer process (prompt)");$();const y=G();document.title=`ShogiHome Prompt - ${y.target} [${y.sessionID}] ${y.name}`;Promise.allSettled([y.setup(),C().loadAppSettings().catch(h=>{y.onError(new Error("アプリ設定の読み込み中にエラーが発生しました: "+h))})]).finally(()=>{const h=C().language;M(h),H.log(L.INFO,"mount app (prompt)"),K(de).mount("#app")});
