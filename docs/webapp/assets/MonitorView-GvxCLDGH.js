var B=Object.defineProperty;var E=(_,e,u)=>e in _?B(_,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):_[e]=u;var k=(_,e,u)=>E(_,typeof e!="symbol"?e+"":e,u);import{f as Q,G as D,H as j,I as z,l as $,g as l,o as d,i as a,z as G,x as t,A as i,t as n,cq as S,n as J,s as h,F as C,v as R,ae as m,a1 as p,ag as M,az as I,a5 as T,cs as b,_ as H}from"./confirm-B6YvaOPl.js";import{P as F}from"./prompt-BVNwYAgJ.js";class w{constructor(e,u){this.width=e,this.height=u}add(e){return new w(this.width+e.width,this.height+e.height)}reduce(e){return new w(this.width-e.width,this.height-e.height)}equals(e){return this.width===e.width&&this.height===e.height}}class O{constructor(e,u,r,v){k(this,"x");k(this,"y");k(this,"width");k(this,"height");if(u!==void 0&&r!==void 0&&v!==void 0)this.x=e,this.y=u,this.width=r,this.height=v;else{const y=JSON.parse(e);this.x=y.x,this.y=y.y,this.width=y.width,this.height=y.height}}get json(){return JSON.stringify({x:this.x,y:this.y,width:this.width,height:this.height})}get style(){return{left:`${this.x}px`,top:`${this.y}px`,width:`${this.width}px`,height:`${this.height}px`}}get size(){return new w(this.width,this.height)}multiply(e){return new O(this.x*e,this.y*e,this.width*e,this.height*e)}}class x{constructor(e,u){this.x=e,this.y=u}add(e){return new x(this.x+e.x,this.y+e.y)}reduce(e){return new x(this.x-e.x,this.y-e.y)}distanceTo(e){return Math.sqrt((this.x-e.x)**2+(this.y-e.y)**2)}angleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}multiply(e){return new x(this.x*e,this.y*e)}equals(e){return this.x===e.x&&this.y===e.y}}const K={class:"full"},W={class:"headers"},X={key:0,class:"entry"},Y={class:"label"},Z={key:0,class:"label warning"},tt={class:"label"},et={class:"key"},st={class:"key"},at={key:1},it={class:"key"},ot={class:"timestamp"},nt={key:2},lt={class:"key"},dt={key:3},ct={class:"command"},rt={key:4,class:"timestamp"},ht={key:5},ut={class:"key"},vt={key:6},mt={class:"command"},pt={key:7,class:"timestamp"},_t={class:"row"},yt=["onClick"],St=["onClick"],gt={key:1,class:"entry"},kt={class:"label"},wt={key:0,class:"label warning"},It={class:"label"},xt={class:"key"},ft={class:"key"},Dt={class:"key"},$t={class:"timestamp"},Mt={key:1},Ct={class:"key"},Rt={key:2},Tt={class:"command"},bt={key:3,class:"timestamp"},Ft={key:4},Ot={class:"key"},Ut={key:5},Nt={class:"command"},Vt={key:6,class:"timestamp"},At={class:"row"},Lt=["onClick"],Pt=["onClick"],qt={key:1,class:"main"},Bt={class:"footer"},Et=Q({__name:"MonitorView",props:{size:{type:w,required:!0}},setup(_){let e=null;const u=D(b()),r=D({os:b(),usiSessions:[],csaSessions:[]}),v=D(0);function y(){p.collectSessionStates().then(o=>{u.value=r.value.os,r.value=o,v.value=new Date().getTime()}).catch(o=>{M().add(o)})}function g(o,c){return`${((c-o)/1e3).toFixed(3)} seconds ago`}j(()=>{y(),e=window.setInterval(y,1e3)}),z(()=>{e!==null&&(window.clearInterval(e),e=null)});const U=$(()=>r.value.os.memoryFree/1024**2),N=$(()=>r.value.os.memoryFree/r.value.os.memoryTotal*100),V=$(()=>{const o=r.value.os.cpuTotalTime-u.value.cpuTotalTime,c=r.value.os.cpuIdleTime-u.value.cpuIdleTime;return o?(1-c/o)*100:0});function A(o){p.log(I.INFO,`MonitorView: Open USI prompt for SID=${o.sessionID} Name=[${o.name}]`),p.openPrompt(F.USI,o.sessionID,o.name)}function L(o){T().show({message:`${o.name} に "quit" を送信します。本当に実行しますか？`,onOk:()=>{p.log(I.INFO,`MonitorView: Send USI quit command to SID=${o.sessionID} Name=[${o.name}]`),p.usiQuit(o.sessionID).catch(c=>{M().add(c)})}})}function P(o){p.log(I.INFO,`MonitorView: Open CSA prompt for SID=${o.sessionID} Server=[${o.host}:${o.port}]`);const c=`${o.host}:${o.port}`;p.openPrompt(F.CSA,o.sessionID,c)}function q(o){T().show({message:`${o.host}:${o.port} への接続を強制終了します。本当に実行しますか？`,onOk:()=>{p.log(I.INFO,`MonitorView: Close CSA session for SID=${o.sessionID} Server=[${o.host}:${o.port}]`),p.csaLogout(o.sessionID).catch(c=>{M().add(c)})}})}return(o,c)=>(d(),l("div",null,[a("div",K,[a("div",{ref:"root",class:"full column",onCopy:c[0]||(c[0]=G(()=>{},["stop"]))},[a("div",W,[a("div",null,t(i(n).updatedAt)+": "+t(v.value?i(S)(new Date(v.value)):"---"),1),a("div",null,t(i(n).usiEngine)+": "+t(r.value.usiSessions.length),1),a("div",null,t(i(n).csaServer)+": "+t(r.value.csaSessions.length),1)]),v.value?(d(),l("div",{key:0,class:"main",style:J({height:`${_.size.height-38}px`})},[r.value.usiSessions.length===0?(d(),l("div",X,[a("div",Y,t(i(n).noRunningUSIEngine),1)])):h("",!0),(d(!0),l(C,null,R(r.value.usiSessions,s=>(d(),l("div",{key:s.sessionID,class:"entry"},[s.closed?(d(),l("div",Z,t(i(n).willBeRemovedFromTheListSoon),1)):h("",!0),a("div",tt,t(i(n).usiEngine)+" - SID: "+t(s.sessionID),1),a("div",null,[a("span",et,t(i(n).name)+":",1),m(" "+t(s.name),1)]),a("div",null,[c[1]||(c[1]=a("span",{class:"key"},"URI:",-1)),m(" "+t(s.uri),1)]),a("div",null,[a("span",st,t(i(n).enginePath)+":",1),m(" "+t(s.path),1)]),s.pid?(d(),l("div",at,[c[2]||(c[2]=a("span",{class:"key"},"PID:",-1)),m(" "+t(s.pid),1)])):h("",!0),a("div",null,[a("span",it,t(i(n).createdAt)+":",1),m(" "+t(i(S)(new Date(s.createdMs)))+" ",1),a("span",ot,"("+t(g(s.createdMs,v.value))+")",1)]),a("div",null,[c[3]||(c[3]=a("span",{class:"key"},"State:",-1)),m(" "+t(s.stateCode),1)]),s.lastSent?(d(),l("div",nt,[a("span",lt,t(i(n).lastSent)+":",1)])):h("",!0),s.lastSent?(d(),l("div",dt,[a("span",ct,t(s.lastSent.command||`(${i(n).blankLine})`),1)])):h("",!0),s.lastSent?(d(),l("div",rt," Sent at "+t(i(S)(new Date(s.lastSent.timeMs)))+" ("+t(g(s.lastSent.timeMs,v.value))+") ",1)):h("",!0),s.lastReceived?(d(),l("div",ht,[a("span",ut,t(i(n).lastReceived)+":",1)])):h("",!0),s.lastReceived?(d(),l("div",vt,[a("span",mt,t(s.lastReceived.command||`(${i(n).blankLine})`),1)])):h("",!0),s.lastReceived?(d(),l("div",pt," Received at "+t(i(S)(new Date(s.lastReceived.timeMs)))+" ("+t(g(s.lastReceived.timeMs,v.value))+") ",1)):h("",!0),a("div",_t,[a("button",{onClick:f=>A(s)},t(i(n).openPrompt),9,yt),a("button",{onClick:f=>L(s)},t(i(n).forceQuit),9,St)])]))),128)),r.value.csaSessions.length===0?(d(),l("div",gt,[a("div",kt,t(i(n).noConnectedCSAServer),1)])):h("",!0),(d(!0),l(C,null,R(r.value.csaSessions,s=>(d(),l("div",{key:s.sessionID,class:"entry"},[s.closed?(d(),l("div",wt,t(i(n).willBeRemovedFromTheListSoon),1)):h("",!0),a("div",It,t(i(n).csaServer)+" - SID: "+t(s.sessionID),1),a("div",null,[a("span",xt,t(i(n).server)+":",1),m(" "+t(s.host)+":"+t(s.port),1)]),a("div",null,[a("span",ft,t(i(n).protocolVersion)+":",1),m(" "+t(s.protocolVersion),1)]),a("div",null,[c[4]||(c[4]=a("span",{class:"key"},"ID:",-1)),m(" "+t(s.loginID),1)]),a("div",null,[a("span",Dt,t(i(n).createdAt)+":",1),m(" "+t(i(S)(new Date(s.createdMs)))+" ",1),a("span",$t,"("+t(g(s.createdMs,v.value))+")",1)]),a("div",null,[c[5]||(c[5]=a("span",{class:"key"},"State:",-1)),m(" "+t(s.stateCode),1)]),s.lastSent?(d(),l("div",Mt,[a("span",Ct,t(i(n).lastSent)+":",1)])):h("",!0),s.lastSent?(d(),l("div",Rt,[a("span",Tt,t(s.lastSent.command||`(${i(n).blankLine})`),1)])):h("",!0),s.lastSent?(d(),l("div",bt," Sent at "+t(i(S)(new Date(s.lastSent.timeMs)))+" ("+t(g(s.lastSent.timeMs,v.value))+") ",1)):h("",!0),s.lastReceived?(d(),l("div",Ft,[a("span",Ot,t(i(n).lastReceived)+":",1)])):h("",!0),s.lastReceived?(d(),l("div",Ut,[a("span",Nt,t(s.lastReceived.command||`(${i(n).blankLine})`),1)])):h("",!0),s.lastReceived?(d(),l("div",Vt," Received at "+t(i(S)(new Date(s.lastReceived.timeMs)))+" ("+t(g(s.lastReceived.timeMs,v.value))+") ",1)):h("",!0),a("div",At,[a("button",{onClick:f=>P(s)},t(i(n).openPrompt),9,Lt),a("button",{onClick:f=>q(s)},t(i(n).forceClose),9,Pt)])]))),128))],4)):(d(),l("div",qt,"Collecting...")),a("div",Bt,[a("span",null,t(r.value.os.version)+"/"+t(r.value.os.arch),1),a("span",null,"CPU Usage: "+t(V.value.toFixed(1))+"%",1),a("span",null,"Memory Free: "+t(U.value.toFixed(2))+"GiB ("+t(N.value.toFixed(1))+"%)",1)])],544)])]))}}),Gt=H(Et,[["__scopeId","data-v-94432962"]]);export{Gt as M,x as P,w as R,O as a};
